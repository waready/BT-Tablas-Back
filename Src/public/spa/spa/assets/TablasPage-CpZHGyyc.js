import{_ as A,S as y,U as u,N as c,V as s,Q as l,W as p,R as r,X as g,Y as v,Z as V,$ as D,a0 as C,a1 as S,a2 as f,a3 as k}from"./index-C6gwNXbs.js";import{Q as P}from"./QTd-5hCHbMUG.js";import{Q as U,a as m}from"./QTable-Dog4vIUz.js";import{Q as F}from"./QPage-Bv0UVxaO.js";import{A as d}from"./ApiService-DPfijE0n.js";import"./position-engine-BAWjjLXH.js";import"./axios-B-OdeLA1.js";const h={CREATE:"inventarios.create",UPDATE:"inventarios.update",DELETE:"inventarios.delete"},q={data(){return{auth:k(),inventarios:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"codigo",label:"Código",field:"codigo",align:"left",sortable:!0},{name:"datos",label:"Datos",field:"datos",align:"left",sortable:!0},{name:"descripcion",label:"Descripción",field:"descripcion",align:"left"},{name:"area_funcional",label:"Área Funcional",field:e=>e.areaFuncional?.nombre??"—",align:"left",sortable:!0},{name:"sistema",label:"Sistema",field:e=>e.sistema?.sistema??"—",align:"left",sortable:!0},{name:"pais",label:"País",field:e=>e.pais?.nombre??"—",align:"left",sortable:!0},{name:"en_desarrollo",label:"En Desarrollo",field:e=>e.en_desarrollo??"—",align:"center",sortable:!0},{name:"capa",label:"Capa",field:"capa",align:"center",sortable:!0},{name:"usuario",label:"Usuario",field:e=>e.usuario??e.user?.username??e.user?.name??"—",align:"left"},{name:"actions",label:"Acciones",align:"center",field:"actions"}],paises:[],sistemas:[],areasFuncionales:[],datos:["Datos","Parámetros"],enDesarrollo:["Inactiva","En Desarrollo","Activa","Desuso"],capa:["Cliente","Core","País"]}},computed:{permSet(){const a=(this.auth?.permissions||[]).map(n=>typeof n=="string"?n:n?.code||n?.name||n?.nombre).filter(Boolean);return new Set(a)},isAdmin(){return(this.auth?.roles||[]).some(a=>typeof a=="string"?a==="admin":(a?.code||a?.name||a?.nombre)==="admin")},canCreate(){return this.isAdmin||this.permSet.has(h.CREATE)},canUpdate(){return this.isAdmin||this.permSet.has(h.UPDATE)},canDelete(){return this.isAdmin||this.permSet.has(h.DELETE)},canSaveDialog(){return!!this.currentItem?.id?this.canUpdate:this.canCreate},columnsSafe(){return this.canUpdate||this.canDelete?this.columns:(this.columns||[]).filter(e=>e.name!=="actions"&&e.name!=="usuario")}},mounted(){this.fetchInventarios(),this.fetchPaises(),this.fetchSistemas(),this.fetchAreasFuncionales()},watch:{search(){this.pagination.page=1,this.fetchInventarios()}},methods:{notifyDenied(){f.create({type:"negative",message:"No tienes permisos para esta acción."})},takeCap(e,a=100){const n=Number(e);return!Number.isFinite(n)||n<=0?10:Math.min(n,a)},async fetchInventarios(){this.loading=!0;try{const e=this.takeCap(this.pagination.rowsPerPage,100),a={page:this.pagination.page,limit:e,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},n=await d.GetInventarios(a);this.inventarios=Array.isArray(n.items)?n.items:[],this.pagination.rowsNumber=Number(n.total)||0,n.page&&(this.pagination.page=Number(n.page)),n.limit&&(this.pagination.rowsPerPage=Number(n.limit))}catch(e){console.error("Error al obtener inventarios",e),this.inventarios=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:e}){const{page:a,rowsPerPage:n,sortBy:b,descending:i}=e;this.pagination.page=a,this.pagination.rowsPerPage=n,this.pagination.sortBy=b,this.pagination.descending=i,this.fetchInventarios()},onSearch(){this.pagination.page=1,this.fetchInventarios()},async fetchPaises(){try{const e=await d.GetPaises();this.paises=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener los países:",e),this.paises=[]}},async fetchSistemas(){try{const e=await d.GetSistemas();this.sistemas=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener los sistemas:",e),this.sistemas=[]}},async fetchAreasFuncionales(){try{const e=await d.GetAreasFuncionales();this.areasFuncionales=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener las áreas:",e),this.areasFuncionales=[]}},openCreateDialog(){if(!this.canCreate)return this.notifyDenied();this.currentItem={codigo:"",descripcion:"",datos:null,en_desarrollo:null,capa:null,areaFuncionalId:null,sistemaId:null,paisId:null},this.dialogVisible=!0},openEditDialog(e){if(!this.canUpdate)return this.notifyDenied();this.currentItem={id:e.id,codigo:e.codigo,descripcion:e.descripcion,datos:e.datos??null,en_desarrollo:e.en_desarrollo??e.estado??null,capa:e.capa??null,areaFuncionalId:e.areaFuncionalId??e.areaFuncional?.id??null,sistemaId:e.sistemaId??e.sistema?.id??null,paisId:e.paisId??e.pais?.id??null},this.dialogVisible=!0},async saveItem(){const e=!!this.currentItem?.id;if(!e&&!this.canCreate)return this.notifyDenied();if(e&&!this.canUpdate)return this.notifyDenied();this.saving=!0;try{const a=this.currentItem,n={codigo:a.codigo,descripcion:a.descripcion,datos:a.datos??null,en_desarrollo:a.en_desarrollo??null,capa:a.capa??null,areaFuncionalId:a.areaFuncionalId??null,sistemaId:a.sistemaId??null,paisId:a.paisId??null};a.id?await d.SetInventario(a.id,n):await d.CreateInventario(n),this.dialogVisible=!1,this.fetchInventarios()}catch(a){console.error("Error al guardar el inventario:",a),f.create({type:"negative",message:"No se pudo guardar."})}finally{this.saving=!1}},confirmDelete(e){if(!this.canDelete)return this.notifyDenied();this.itemToDelete=e,this.deleteDialogVisible=!0},async deleteItem(){if(!this.canDelete)return this.notifyDenied();this.deleting=!0;try{await d.DeleteInventario(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchInventarios()}catch(e){console.error("Error al eliminar el inventario:",e),f.create({type:"negative",message:"No se pudo eliminar."})}finally{this.deleting=!1}}}};function N(e,a,n,b,i,o){const I=y("q-col"),E=y("q-row");return c(),u(F,{class:"q-pa-md"},{default:s(()=>[l(U,{rows:i.inventarios||[],columns:o.columnsSafe,"row-key":"id",loading:i.loading,pagination:i.pagination,"onUpdate:pagination":a[1]||(a[1]=t=>i.pagination=t),"rows-per-page-label":"Registros por página:","rows-per-page-options":[10,25,50,100],"no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:o.onRequest,class:"q-mb-md"},{"top-left":s(()=>[o.canCreate?(c(),u(r,{key:0,label:"Crear",color:"secondary",onClick:o.openCreateDialog,class:"q-mr-md",rounded:""},null,8,["onClick"])):p("",!0)]),"top-right":s(()=>[l(g,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:i.search,"onUpdate:modelValue":a[0]||(a[0]=t=>i.search=t),onInput:o.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":s(t=>[l(P,{props:t,class:"q-pa-none"},{default:s(()=>[o.canUpdate?(c(),u(r,{key:0,flat:"",color:"secondary",icon:"edit",onClick:w=>o.openEditDialog(t.row),class:"q-mr-xs",round:""},null,8,["onClick"])):p("",!0),o.canDelete?(c(),u(r,{key:1,flat:"",color:"negative",icon:"delete",onClick:w=>o.confirmDelete(t.row.id),round:""},null,8,["onClick"])):p("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),l(v,{modelValue:i.dialogVisible,"onUpdate:modelValue":a[11]||(a[11]=t=>i.dialogVisible=t)},{default:s(()=>[l(V,{class:"q-pa-md",style:{width:"800px"}},{default:s(()=>[l(D,null,{default:s(()=>[l(E,{class:"q-gutter-md"},{default:s(()=>[l(I,{cols:12,md:6},{default:s(()=>[l(g,{modelValue:i.currentItem.codigo,"onUpdate:modelValue":a[2]||(a[2]=t=>i.currentItem.codigo=t),label:"Código",outlined:""},null,8,["modelValue"]),l(g,{modelValue:i.currentItem.descripcion,"onUpdate:modelValue":a[3]||(a[3]=t=>i.currentItem.descripcion=t),label:"Descripción",outlined:""},null,8,["modelValue"]),l(m,{modelValue:i.currentItem.datos,"onUpdate:modelValue":a[4]||(a[4]=t=>i.currentItem.datos=t),label:"Datos",options:i.datos,outlined:""},null,8,["modelValue","options"]),l(m,{modelValue:i.currentItem.areaFuncionalId,"onUpdate:modelValue":a[5]||(a[5]=t=>i.currentItem.areaFuncionalId=t),label:"Área Funcional",options:i.areasFuncionales,"option-value":"id","option-label":"nombre","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"])]),_:1}),l(I,{cols:12,md:6},{default:s(()=>[l(m,{modelValue:i.currentItem.sistemaId,"onUpdate:modelValue":a[6]||(a[6]=t=>i.currentItem.sistemaId=t),label:"Sistema",options:i.sistemas,"option-value":"id","option-label":"sistema","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"]),l(m,{modelValue:i.currentItem.en_desarrollo,"onUpdate:modelValue":a[7]||(a[7]=t=>i.currentItem.en_desarrollo=t),label:"En Desarrollo",options:i.enDesarrollo,outlined:""},null,8,["modelValue","options"]),l(m,{modelValue:i.currentItem.capa,"onUpdate:modelValue":a[8]||(a[8]=t=>i.currentItem.capa=t),label:"Capa",options:i.capa,outlined:""},null,8,["modelValue","options"]),l(m,{modelValue:i.currentItem.paisId,"onUpdate:modelValue":a[9]||(a[9]=t=>i.currentItem.paisId=t),options:i.paises,label:"País","option-label":"nombre","option-value":"id","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),l(C,{align:"right"},{default:s(()=>[o.canSaveDialog?(c(),u(r,{key:0,onClick:o.saveItem,color:"secondary",label:"Guardar",loading:i.saving},null,8,["onClick","loading"])):p("",!0),l(r,{onClick:a[10]||(a[10]=t=>i.dialogVisible=!1),color:"negative",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(v,{modelValue:i.deleteDialogVisible,"onUpdate:modelValue":a[13]||(a[13]=t=>i.deleteDialogVisible=t)},{default:s(()=>[l(V,{class:"q-pa-md"},{default:s(()=>[l(D,null,{default:s(()=>[...a[14]||(a[14]=[S("¿Estás seguro de que deseas eliminar este registro?",-1)])]),_:1}),l(C,{align:"right"},{default:s(()=>[o.canDelete?(c(),u(r,{key:0,onClick:o.deleteItem,color:"negative",label:"Eliminar",loading:i.deleting},null,8,["onClick","loading"])):p("",!0),l(r,{onClick:a[12]||(a[12]=t=>i.deleteDialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const L=A(q,[["render",N],["__scopeId","data-v-357bca58"]]);export{L as default};
