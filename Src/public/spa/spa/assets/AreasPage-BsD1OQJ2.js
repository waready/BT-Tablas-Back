import{_ as A,U as c,N as u,V as l,Q as s,W as d,R as o,X as g,Y as b,Z as y,$ as C,a0 as V,a1 as w,a2 as h,a3 as v}from"./index-DoNdm23b.js";import{Q as E}from"./QTd-BVHgFqKU.js";import{Q as I}from"./QTable-BBpWQ1VS.js";import{Q as k}from"./QPage-D4RWoOZ7.js";import{A as m}from"./ApiService-D_JDuaKY.js";import"./position-engine-C0na6ooX.js";import"./axios-BXLeQQ8K.js";const p={CREATE:"areas_funcionales.create",UPDATE:"areas_funcionales.update",DELETE:"areas_funcionales.delete"},S={data(){return{auth:v(),areasFuncionales:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"codigo",label:"Código",field:"codigo",align:"left",sortable:!0},{name:"nombre",label:"Descripción",field:"nombre",align:"left"},{name:"actions",label:"Acciones",field:"actions",align:"center"}]}},computed:{permSet(){const e=(this.auth?.permissions||[]).map(i=>typeof i=="string"?i:i?.code||i?.name||i?.nombre).filter(Boolean);return new Set(e)},isAdmin(){return(this.auth?.roles||[]).some(e=>typeof e=="string"?e==="admin":(e?.code||e?.name||e?.nombre)==="admin")},canCreate(){return this.isAdmin||this.permSet.has(p.CREATE)},canUpdate(){return this.isAdmin||this.permSet.has(p.UPDATE)},canDelete(){return this.isAdmin||this.permSet.has(p.DELETE)},canSaveDialog(){return!!this.currentItem?.id?this.canUpdate:this.canCreate},columnsSafe(){return this.canUpdate||this.canDelete?this.columns:(this.columns||[]).filter(a=>a.name!=="actions")}},mounted(){this.fetchAreasFuncionales()},watch:{search(){this.pagination.page=1,this.fetchAreasFuncionales()}},methods:{deny(){h.create({type:"negative",message:"No tienes permisos para esta acción."})},capLimit(a,e=100){const i=Number(a);return!Number.isFinite(i)||i<=0?10:Math.min(i,e)},async fetchAreasFuncionales(){this.loading=!0;try{const a=this.capLimit(this.pagination.rowsPerPage,100),e={page:this.pagination.page,limit:a,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},i=await m.GetAreasFuncionales(e);this.areasFuncionales=Array.isArray(i.items)?i.items:[],this.pagination.rowsNumber=Number(i.total)||0,i.page&&(this.pagination.page=Number(i.page)),i.limit&&(this.pagination.rowsPerPage=Number(i.limit))}catch(a){console.error("Error al obtener las áreas funcionales:",a),this.areasFuncionales=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:a}){const{page:e,rowsPerPage:i,sortBy:f,descending:t}=a;this.pagination.page=e,this.pagination.rowsPerPage=i,this.pagination.sortBy=f,this.pagination.descending=t,this.fetchAreasFuncionales()},onSearch(){this.pagination.page=1,this.fetchAreasFuncionales()},openCreateDialog(){if(!this.canCreate)return this.deny();this.currentItem={codigo:"",nombre:""},this.dialogVisible=!0},openEditDialog(a){if(!this.canUpdate)return this.deny();this.currentItem={...a},this.dialogVisible=!0},async saveItem(){const a=!!this.currentItem?.id;if(!a&&!this.canCreate)return this.deny();if(a&&!this.canUpdate)return this.deny();this.saving=!0;try{const e={codigo:this.currentItem.codigo,nombre:this.currentItem.nombre};this.currentItem.id?await m.SetAreasFuncionales(this.currentItem.id,e):await m.CreateAreasFuncionales(e),this.dialogVisible=!1,this.fetchAreasFuncionales()}catch(e){console.error("Error al guardar el área funcional:",e),h.create({type:"negative",message:"No se pudo guardar."})}finally{this.saving=!1}},confirmDelete(a){if(!this.canDelete)return this.deny();this.itemToDelete=a,this.deleteDialogVisible=!0},async deleteItem(){if(!this.canDelete)return this.deny();this.deleting=!0;try{await m.DeleteAreasFuncionales(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchAreasFuncionales()}catch(a){console.error("Error al eliminar el área funcional:",a),h.create({type:"negative",message:"No se pudo eliminar."})}finally{this.deleting=!1}}}};function F(a,e,i,f,t,r){return u(),c(k,{class:"q-pa-md"},{default:l(()=>[s(I,{rows:t.areasFuncionales||[],columns:r.columnsSafe,"row-key":"id",loading:t.loading,pagination:t.pagination,"onUpdate:pagination":e[1]||(e[1]=n=>t.pagination=n),"rows-per-page-label":"Registros por página:","rows-per-page-options":[10,25,50,100],"binary-state-sort":"","no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:r.onRequest,class:"q-mb-md"},{"top-left":l(()=>[r.canCreate?(u(),c(o,{key:0,label:"Crear Nueva Área Funcional",color:"secondary",onClick:r.openCreateDialog,class:"q-mb-md",rounded:""},null,8,["onClick"])):d("",!0)]),"top-right":l(()=>[s(g,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:t.search,"onUpdate:modelValue":e[0]||(e[0]=n=>t.search=n),onInput:r.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":l(n=>[s(E,{props:n,class:"q-pa-none"},{default:l(()=>[r.canUpdate?(u(),c(o,{key:0,flat:"",color:"secondary",icon:"edit",onClick:D=>r.openEditDialog(n.row),class:"q-mr-xs",round:""},null,8,["onClick"])):d("",!0),r.canDelete?(u(),c(o,{key:1,flat:"",color:"negative",icon:"delete",onClick:D=>r.confirmDelete(n.row.id),round:""},null,8,["onClick"])):d("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),s(b,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=n=>t.dialogVisible=n)},{default:l(()=>[s(y,{class:"q-pa-md",style:{"max-width":"520px"}},{default:l(()=>[s(C,null,{default:l(()=>[s(g,{modelValue:t.currentItem.codigo,"onUpdate:modelValue":e[2]||(e[2]=n=>t.currentItem.codigo=n),label:"Código del Área",outlined:""},null,8,["modelValue"]),s(g,{modelValue:t.currentItem.nombre,"onUpdate:modelValue":e[3]||(e[3]=n=>t.currentItem.nombre=n),label:"Descripción",outlined:""},null,8,["modelValue"])]),_:1}),s(V,{align:"right"},{default:l(()=>[r.canSaveDialog?(u(),c(o,{key:0,onClick:r.saveItem,color:"primary",label:"Guardar",loading:t.saving},null,8,["onClick","loading"])):d("",!0),s(o,{onClick:e[4]||(e[4]=n=>t.dialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(b,{modelValue:t.deleteDialogVisible,"onUpdate:modelValue":e[7]||(e[7]=n=>t.deleteDialogVisible=n)},{default:l(()=>[s(y,{class:"q-pa-md",style:{"max-width":"420px"}},{default:l(()=>[s(C,null,{default:l(()=>[...e[8]||(e[8]=[w("¿Estás seguro de que deseas eliminar esta área funcional?",-1)])]),_:1}),s(V,{align:"right"},{default:l(()=>[r.canDelete?(u(),c(o,{key:0,onClick:r.deleteItem,color:"negative",label:"Eliminar",loading:t.deleting},null,8,["onClick","loading"])):d("",!0),s(o,{onClick:e[6]||(e[6]=n=>t.deleteDialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const B=A(S,[["render",F],["__scopeId","data-v-585879ec"]]);export{B as default};
